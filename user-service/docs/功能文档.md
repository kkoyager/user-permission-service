# User Service åŠŸèƒ½æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

User Service æ˜¯ç”¨æˆ·ç®¡ç†å¾®æœåŠ¡ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·ç›¸å…³çš„æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ³¨å†Œã€èº«ä»½è®¤è¯ã€ä¿¡æ¯ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ã€‚æœ¬æœåŠ¡é‡‡ç”¨å¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼Œæ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨çš„ç”¨æˆ·ç®¡ç†éœ€æ±‚ã€‚

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·æ³¨å†Œæ¨¡å—

#### åŠŸèƒ½æè¿°
æä¾›æ–°ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·åã€é‚®ç®±ã€æ‰‹æœºå·ç­‰å¤šç§æ³¨å†Œæ–¹å¼ï¼Œç¡®ä¿ç”¨æˆ·ä¿¡æ¯çš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§ã€‚

#### ä¸»è¦ç‰¹æ€§
- âœ… ç”¨æˆ·åå”¯ä¸€æ€§éªŒè¯
- âœ… é‚®ç®±æ ¼å¼éªŒè¯å’Œå”¯ä¸€æ€§æ£€æŸ¥
- âœ… æ‰‹æœºå·æ ¼å¼éªŒè¯ï¼ˆå¯é€‰ï¼‰
- âœ… å¯†ç å¼ºåº¦éªŒè¯
- âœ… å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆBCryptï¼‰
- âœ… è‡ªåŠ¨åˆ†é…é»˜è®¤è§’è‰²
- âœ… åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒ
- âœ… æ³¨å†Œæ—¥å¿—è®°å½•

#### ä¸šåŠ¡æµç¨‹
```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant UserService as ç”¨æˆ·æœåŠ¡
    participant PermissionService as æƒé™æœåŠ¡
    participant DB as æ•°æ®åº“
    participant MQ as æ¶ˆæ¯é˜Ÿåˆ—

    Client->>UserService: æäº¤æ³¨å†Œä¿¡æ¯
    UserService->>UserService: å‚æ•°éªŒè¯
    UserService->>DB: æ£€æŸ¥ç”¨æˆ·å/é‚®ç®±å”¯ä¸€æ€§
    UserService->>UserService: å¯†ç åŠ å¯†
    UserService->>DB: ä¿å­˜ç”¨æˆ·ä¿¡æ¯
    UserService->>PermissionService: ç»‘å®šé»˜è®¤è§’è‰²
    UserService->>MQ: å‘é€æ³¨å†Œæ—¥å¿—æ¶ˆæ¯
    UserService->>Client: è¿”å›æ³¨å†Œç»“æœ
```

#### éªŒè¯è§„åˆ™
| å­—æ®µ | è§„åˆ™ | è¯´æ˜ |
|------|------|------|
| username | 3-20å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ | ç”¨æˆ·åå¿…é¡»å”¯ä¸€ |
| password | 6-50å­—ç¬¦ | å»ºè®®åŒ…å«å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ |
| email | æ ‡å‡†é‚®ç®±æ ¼å¼ | é‚®ç®±å¿…é¡»å”¯ä¸€ |
| phone | 11ä½æ‰‹æœºå·ï¼ˆå¯é€‰ï¼‰ | æ”¯æŒä¸­å›½å¤§é™†æ‰‹æœºå·æ ¼å¼ |

#### é”™è¯¯å¤„ç†
- **ç”¨æˆ·åå·²å­˜åœ¨**: è¿”å›400é”™è¯¯ï¼Œæç¤ºç”¨æˆ·åé‡å¤
- **é‚®ç®±å·²å­˜åœ¨**: è¿”å›400é”™è¯¯ï¼Œæç¤ºé‚®ç®±é‡å¤
- **å¯†ç æ ¼å¼é”™è¯¯**: è¿”å›400é”™è¯¯ï¼Œæç¤ºå¯†ç è§„åˆ™
- **æƒé™æœåŠ¡è°ƒç”¨å¤±è´¥**: äº‹åŠ¡å›æ»šï¼Œè¿”å›500é”™è¯¯

---

### 2. ç”¨æˆ·ç™»å½•æ¨¡å—

#### åŠŸèƒ½æè¿°
æä¾›ç”¨æˆ·èº«ä»½è®¤è¯åŠŸèƒ½ï¼ŒéªŒè¯ç”¨æˆ·å‡­æ®å¹¶ç”ŸæˆJWTè®¿é—®ä»¤ç‰Œï¼Œæ”¯æŒæ— çŠ¶æ€çš„åˆ†å¸ƒå¼è®¤è¯ã€‚

#### ä¸»è¦ç‰¹æ€§
- âœ… ç”¨æˆ·å/å¯†ç è®¤è¯
- âœ… å¯†ç å®‰å…¨éªŒè¯ï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰
- âœ… JWTä»¤ç‰Œç”Ÿæˆ
- âœ… ä»¤ç‰Œè¿‡æœŸæ§åˆ¶
- âœ… ç™»å½•æ—¥å¿—è®°å½•
- âœ… ç™»å½•çŠ¶æ€è¿½è¸ª

#### ä¸šåŠ¡æµç¨‹
```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant UserService as ç”¨æˆ·æœåŠ¡
    participant DB as æ•°æ®åº“
    participant MQ as æ¶ˆæ¯é˜Ÿåˆ—

    Client->>UserService: æäº¤ç™»å½•å‡­æ®
    UserService->>DB: æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    UserService->>UserService: éªŒè¯å¯†ç 
    UserService->>UserService: ç”ŸæˆJWTä»¤ç‰Œ
    UserService->>MQ: å‘é€ç™»å½•æ—¥å¿—æ¶ˆæ¯
    UserService->>Client: è¿”å›JWTä»¤ç‰Œ
```

#### JWTä»¤ç‰Œè®¾è®¡
```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "userId": 1001,
    "username": "testuser",
    "iat": 1624267200,
    "exp": 1624353600
  },
  "signature": "ç­¾åä¿¡æ¯"
}
```

#### å®‰å…¨æœºåˆ¶
- **å¯†ç åŠ å¯†**: ä½¿ç”¨BCryptè¿›è¡Œå¯†ç å“ˆå¸Œ
- **ä»¤ç‰Œè¿‡æœŸ**: é»˜è®¤24å°æ—¶è¿‡æœŸ
- **ç­¾åéªŒè¯**: ä½¿ç”¨HMAC SHA256ç®—æ³•
- **IPåœ°å€è®°å½•**: è®°å½•ç™»å½•IPç”¨äºå®‰å…¨å®¡è®¡

---

### 3. ç”¨æˆ·ä¿¡æ¯ç®¡ç†æ¨¡å—

#### åŠŸèƒ½æè¿°
æä¾›ç”¨æˆ·ä¿¡æ¯çš„æŸ¥è¯¢ã€æ›´æ–°åŠŸèƒ½ï¼Œæ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚

#### ä¸»è¦ç‰¹æ€§
- âœ… ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢
- âœ… åˆ†é¡µç”¨æˆ·åˆ—è¡¨æŸ¥è¯¢
- âœ… ç”¨æˆ·ä¿¡æ¯æ›´æ–°
- âœ… æƒé™æ§åˆ¶ï¼ˆç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„ä¿¡æ¯ï¼‰
- âœ… ç®¡ç†å‘˜ç‰¹æƒï¼ˆå¯æ“ä½œæ‰€æœ‰ç”¨æˆ·ï¼‰
- âœ… æ“ä½œæ—¥å¿—è®°å½•

#### æƒé™æ§åˆ¶çŸ©é˜µ
| æ“ä½œ | æ™®é€šç”¨æˆ· | ç®¡ç†å‘˜ | è¶…çº§ç®¡ç†å‘˜ |
|------|----------|--------|------------|
| æŸ¥çœ‹è‡ªå·±ä¿¡æ¯ | âœ… | âœ… | âœ… |
| æŸ¥çœ‹ä»–äººä¿¡æ¯ | âŒ | âœ… | âœ… |
| ä¿®æ”¹è‡ªå·±ä¿¡æ¯ | âœ… | âœ… | âœ… |
| ä¿®æ”¹ä»–äººä¿¡æ¯ | âŒ | âœ… | âœ… |
| æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ | ä»…è‡ªå·± | âœ… | âœ… |

#### å¯æ›´æ–°å­—æ®µ
- **é‚®ç®±åœ°å€**: éœ€è¦éªŒè¯æ ¼å¼å’Œå”¯ä¸€æ€§
- **æ‰‹æœºå·ç **: éœ€è¦éªŒè¯æ ¼å¼
- **ä¸ªäººèµ„æ–™**: æ˜µç§°ã€å¤´åƒç­‰æ‰©å±•ä¿¡æ¯

#### ä¸å¯æ›´æ–°å­—æ®µ
- **ç”¨æˆ·å**: åˆ›å»ºåä¸å¯ä¿®æ”¹
- **å¯†ç **: é€šè¿‡ä¸“é—¨çš„é‡ç½®æ¥å£ä¿®æ”¹
- **ç”¨æˆ·ID**: ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ
- **åˆ›å»ºæ—¶é—´**: ç³»ç»Ÿè‡ªåŠ¨è®¾ç½®

---

### 4. å¯†ç ç®¡ç†æ¨¡å—

#### åŠŸèƒ½æè¿°
æä¾›å¯†ç é‡ç½®åŠŸèƒ½ï¼Œæ”¯æŒç®¡ç†å‘˜é‡ç½®ç”¨æˆ·å¯†ç ï¼Œç¡®ä¿å¯†ç å®‰å…¨æ€§ã€‚

#### ä¸»è¦ç‰¹æ€§
- âœ… ç®¡ç†å‘˜å¯†ç é‡ç½®
- âœ… å¯†ç å¼ºåº¦éªŒè¯
- âœ… å¯†ç åŠ å¯†å­˜å‚¨
- âœ… é‡ç½®æ—¥å¿—è®°å½•
- âœ… æƒé™éªŒè¯

#### ä¸šåŠ¡æµç¨‹
```mermaid
sequenceDiagram
    participant Admin as ç®¡ç†å‘˜
    participant UserService as ç”¨æˆ·æœåŠ¡
    participant PermissionService as æƒé™æœåŠ¡
    participant DB as æ•°æ®åº“
    participant MQ as æ¶ˆæ¯é˜Ÿåˆ—

    Admin->>UserService: æäº¤é‡ç½®è¯·æ±‚
    UserService->>PermissionService: éªŒè¯ç®¡ç†å‘˜æƒé™
    UserService->>UserService: éªŒè¯æ–°å¯†ç æ ¼å¼
    UserService->>UserService: åŠ å¯†æ–°å¯†ç 
    UserService->>DB: æ›´æ–°ç”¨æˆ·å¯†ç 
    UserService->>MQ: å‘é€é‡ç½®æ—¥å¿—æ¶ˆæ¯
    UserService->>Admin: è¿”å›é‡ç½®ç»“æœ
```

#### é‡ç½®ç­–ç•¥
- **æƒé™è¦æ±‚**: ä»…ç®¡ç†å‘˜å¯æ‰§è¡Œ
- **ç›®æ ‡ç”¨æˆ·**: ä¸èƒ½é‡ç½®è¶…çº§ç®¡ç†å‘˜å¯†ç 
- **å¯†ç è§„åˆ™**: ä¸æ³¨å†Œæ—¶ç›¸åŒçš„å¯†ç å¼ºåº¦è¦æ±‚
- **å®‰å…¨å®¡è®¡**: è®°å½•é‡ç½®æ“ä½œçš„è¯¦ç»†æ—¥å¿—

---

### 5. æƒé™é›†æˆæ¨¡å—

#### åŠŸèƒ½æè¿°
é€šè¿‡Feignå®¢æˆ·ç«¯ä¸æƒé™æœåŠ¡é›†æˆï¼Œå®ç°åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ã€‚

#### ä¸»è¦ç‰¹æ€§
- âœ… ç”¨æˆ·è§’è‰²æŸ¥è¯¢
- âœ… æƒé™éªŒè¯
- âœ… æœåŠ¡é—´é€šä¿¡
- âœ… ç†”æ–­é™çº§
- âœ… è¶…æ—¶æ§åˆ¶

#### è§’è‰²ä½“ç³»
```
è¶…çº§ç®¡ç†å‘˜ (super_admin)
â”œâ”€â”€ ç®¡ç†å‘˜ (admin)
â”‚   â”œâ”€â”€ ç”¨æˆ·ç®¡ç†æƒé™
â”‚   â”œâ”€â”€ å¯†ç é‡ç½®æƒé™
â”‚   â””â”€â”€ æ•°æ®æŸ¥çœ‹æƒé™
â””â”€â”€ æ™®é€šç”¨æˆ· (user)
    â”œâ”€â”€ ä¸ªäººä¿¡æ¯ç®¡ç†
    â””â”€â”€ åŸºç¡€åŠŸèƒ½è®¿é—®
```

#### æƒé™éªŒè¯é€»è¾‘
```java
public boolean hasPermission(Long currentUserId, Long targetUserId) {
    // ç”¨æˆ·å¯ä»¥æ“ä½œè‡ªå·±
    if (currentUserId.equals(targetUserId)) {
        return true;
    }
    
    // è·å–å½“å‰ç”¨æˆ·è§’è‰²
    String currentRole = getUserRole(currentUserId);
    String targetRole = getUserRole(targetUserId);
    
    // ç®¡ç†å‘˜å¯ä»¥æ“ä½œæ™®é€šç”¨æˆ·
    if ("admin".equals(currentRole) && "user".equals(targetRole)) {
        return true;
    }
    
    // è¶…çº§ç®¡ç†å‘˜å¯ä»¥æ“ä½œæ‰€æœ‰ç”¨æˆ·
    if ("super_admin".equals(currentRole)) {
        return true;
    }
    
    return false;
}
```

---

### 6. æ—¥å¿—è®°å½•æ¨¡å—

#### åŠŸèƒ½æè¿°
è®°å½•ç”¨æˆ·æ“ä½œæ—¥å¿—ï¼Œæ”¯æŒæ“ä½œå®¡è®¡å’Œå®‰å…¨ç›‘æ§ã€‚

#### ä¸»è¦ç‰¹æ€§
- âœ… å¼‚æ­¥æ—¥å¿—è®°å½•
- âœ… æ“ä½œè½¨è¿¹è¿½è¸ª
- âœ… å®‰å…¨äº‹ä»¶ç›‘æ§
- âœ… æ€§èƒ½å½±å“æœ€å°åŒ–

#### æ—¥å¿—ç±»å‹
| æ“ä½œç±»å‹ | è®°å½•å†…å®¹ | é‡è¦çº§åˆ« |
|----------|----------|----------|
| ç”¨æˆ·æ³¨å†Œ | ç”¨æˆ·IDã€ç”¨æˆ·åã€IPåœ°å€ã€æ—¶é—´ | INFO |
| ç”¨æˆ·ç™»å½• | ç”¨æˆ·IDã€ç”¨æˆ·åã€IPåœ°å€ã€æ—¶é—´ | INFO |
| ä¿¡æ¯æ›´æ–° | ç”¨æˆ·IDã€æ›´æ–°å­—æ®µã€IPåœ°å€ã€æ—¶é—´ | INFO |
| å¯†ç é‡ç½® | ç›®æ ‡ç”¨æˆ·IDã€æ“ä½œå‘˜IDã€IPåœ°å€ã€æ—¶é—´ | WARN |
| æƒé™å¼‚å¸¸ | ç”¨æˆ·IDã€æ“ä½œç±»å‹ã€IPåœ°å€ã€æ—¶é—´ | ERROR |

#### æ—¥å¿—æ ¼å¼
```json
{
  "timestamp": "2024-06-21T10:30:00.000Z",
  "userId": 1001,
  "action": "USER_REGISTER",
  "detail": "ç”¨æˆ·æ³¨å†ŒæˆåŠŸ",
  "ip": "192.168.1.100",
  "userAgent": "Mozilla/5.0...",
  "result": "SUCCESS"
}
```

---

### 7. å¥åº·æ£€æŸ¥æ¨¡å—

#### åŠŸèƒ½æè¿°
æä¾›æœåŠ¡å¥åº·çŠ¶æ€æ£€æŸ¥ï¼Œæ”¯æŒæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚

#### ä¸»è¦ç‰¹æ€§
- âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥
- âœ… ä¾èµ–æœåŠ¡æ£€æŸ¥
- âœ… æ•°æ®åº“è¿æ¥æ£€æŸ¥
- âœ… å†…å­˜ä½¿ç”¨ç›‘æ§

#### æ£€æŸ¥é¡¹ç›®
```yaml
å¥åº·æ£€æŸ¥é¡¹ç›®:
  - åº”ç”¨çŠ¶æ€: UP/DOWN
  - æ•°æ®åº“è¿æ¥: UP/DOWN
  - æƒé™æœåŠ¡è¿æ¥: UP/DOWN
  - æ¶ˆæ¯é˜Ÿåˆ—è¿æ¥: UP/DOWN
  - å†…å­˜ä½¿ç”¨ç‡: < 80%
  - ç£ç›˜ç©ºé—´: > 1GB
```

#### å¥åº·æŠ¥å‘Šç¤ºä¾‹
```json
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "MySQL",
        "validationQuery": "isValid()"
      }
    },
    "diskSpace": {
      "status": "UP",
      "details": {
        "total": 10737418240,
        "free": 8589934592,
        "threshold": 1073741824
      }
    }
  }
}
```

## æŠ€æœ¯å®ç°

### 1. æ•°æ®æ¨¡å‹è®¾è®¡

#### ç”¨æˆ·å®ä½“ (User)
```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long userId;
    
    @Column(unique = true, nullable = false, length = 50)
    private String username;
    
    @Column(nullable = false)
    private String password;
    
    @Column(unique = true, nullable = false, length = 100)
    private String email;
    
    @Column(length = 20)
    private String phone;
    
    @CreationTimestamp
    private LocalDateTime createdAt;
    
    @UpdateTimestamp
    private LocalDateTime updatedAt;
}
```

#### æ•°æ®ä¼ è¾“å¯¹è±¡è®¾è®¡
- **UserRegisterRequest**: æ³¨å†Œè¯·æ±‚
- **UserLoginRequest**: ç™»å½•è¯·æ±‚
- **UserUpdateRequest**: æ›´æ–°è¯·æ±‚
- **UserResponse**: ç”¨æˆ·ä¿¡æ¯å“åº”
- **ApiResponse<T>**: ç»Ÿä¸€å“åº”æ ¼å¼

### 2. æœåŠ¡å±‚æ¶æ„

#### æ¥å£è®¾è®¡
```java
public interface UserService {
    ApiResponse<UserResponse> register(UserRegisterRequest request, String clientIp);
    ApiResponse<String> login(UserLoginRequest request, String clientIp);
    ApiResponse<UserResponse> getUserById(Long userId, Long currentUserId);
    ApiResponse<Page<UserResponse>> getUserList(Long currentUserId, Pageable pageable);
    ApiResponse<UserResponse> updateUser(Long userId, UserUpdateRequest request, Long currentUserId, String clientIp);
    ApiResponse<String> resetPassword(Long userId, String newPassword, Long currentUserId, String clientIp);
    String getUserRole(Long userId);
    boolean hasPermission(Long currentUserId, Long targetUserId);
}
```

#### å®ç°ç‰¹ç‚¹
- **äº‹åŠ¡ç®¡ç†**: ä½¿ç”¨@Transactionalç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶
- **å‚æ•°éªŒè¯**: å¤šå±‚éªŒè¯ç¡®ä¿æ•°æ®å®‰å…¨
- **æ€§èƒ½ä¼˜åŒ–**: åˆç†çš„æŸ¥è¯¢ç­–ç•¥å’Œç¼“å­˜æœºåˆ¶

### 3. æ§åˆ¶å™¨å±‚è®¾è®¡

#### REST APIè®¾è®¡
```java
@RestController
@RequestMapping("/user")
public class UserController {
    @PostMapping("/register")
    public ApiResponse<UserResponse> register(@RequestBody UserRegisterRequest request, HttpServletRequest httpRequest);
    
    @PostMapping("/login")
    public ApiResponse<String> login(@RequestBody UserLoginRequest request, HttpServletRequest httpRequest);
    
    @GetMapping("/{userId}")
    public ApiResponse<UserResponse> getUserInfo(@PathVariable Long userId, HttpServletRequest httpRequest);
    
    @GetMapping("/users")
    public ApiResponse<Page<UserResponse>> getUserList(@RequestParam(defaultValue = "0") int page, @RequestParam(defaultValue = "10") int size, HttpServletRequest httpRequest);
    
    @PutMapping("/{userId}")
    public ApiResponse<UserResponse> updateUser(@PathVariable Long userId, @RequestBody UserUpdateRequest request, HttpServletRequest httpRequest);
    
    @PostMapping("/reset-password")
    public ApiResponse<String> resetPassword(@RequestBody ResetPasswordRequest request, HttpServletRequest httpRequest);
    
    @GetMapping("/current-role")
    public ApiResponse<String> getCurrentUserRole(HttpServletRequest httpRequest);
    
    @GetMapping("/health")
    public ApiResponse<String> health();
}
```

### 4. å®‰å…¨æœºåˆ¶

#### JWTè®¤è¯
```java
@Component
public class JwtUtil {
    public String generateToken(Long userId, String username);
    public boolean validateToken(String token);
    public Long getUserIdFromToken(String token);
    public String getUsernameFromToken(String token);
}
```

#### å¯†ç åŠ å¯†
```java
@Component
public class PasswordUtil {
    public boolean isValidPassword(String password);
    public String encryptPassword(String password);
    public boolean verifyPassword(String rawPassword, String encodedPassword);
}
```

### 5. é›†æˆæœåŠ¡

#### æƒé™æœåŠ¡å®¢æˆ·ç«¯
```java
@FeignClient(name = "permission-service")
public interface PermissionServiceClient {
    @PostMapping("/rpc/user/{userId}/role/default")
    String bindDefaultRole(@PathVariable("userId") Long userId);
    
    @GetMapping("/rpc/user/{userId}/role")
    String getUserRoleCode(@PathVariable("userId") Long userId);
}
```

#### æ¶ˆæ¯å‘é€å·¥å…·
```java
@Component
public class MessageUtil {
    public void sendRegisterLog(Long userId, String username, String ip);
    public void sendLoginLog(Long userId, String username, String ip);
    public void sendUpdateLog(Long userId, String detail, String ip);
    public void sendPasswordResetLog(Long userId, String ip);
}
```

## æ€§èƒ½ç‰¹æ€§

### 1. å“åº”æ—¶é—´æŒ‡æ ‡

| æ¥å£ | å¹³å‡å“åº”æ—¶é—´ | 95%å“åº”æ—¶é—´ | 99%å“åº”æ—¶é—´ |
|------|-------------|-------------|-------------|
| ç”¨æˆ·æ³¨å†Œ | 200ms | 500ms | 1000ms |
| ç”¨æˆ·ç™»å½• | 150ms | 300ms | 600ms |
| æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ | 50ms | 100ms | 200ms |
| æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | 100ms | 200ms | 400ms |

### 2. å¹¶å‘å¤„ç†èƒ½åŠ›

- **QPS**: 1000+ (åœ¨4æ ¸8GBé…ç½®ä¸‹)
- **è¿æ¥æ± **: é»˜è®¤20ä¸ªæ•°æ®åº“è¿æ¥
- **çº¿ç¨‹æ± **: Tomcaté»˜è®¤200ä¸ªå·¥ä½œçº¿ç¨‹
- **å†…å­˜ä½¿ç”¨**: æ­£å¸¸è¿è¡Œæ—¶çº¦500MB

### 3. ä¼˜åŒ–ç­–ç•¥

#### æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•è®¾è®¡**: usernameã€emailå”¯ä¸€ç´¢å¼•
- **è¿æ¥æ± **: HikariCPè¿æ¥æ± ä¼˜åŒ–
- **æŸ¥è¯¢ä¼˜åŒ–**: é¿å…N+1æŸ¥è¯¢é—®é¢˜

#### åº”ç”¨ä¼˜åŒ–
- **å¼‚æ­¥å¤„ç†**: æ—¥å¿—è®°å½•å¼‚æ­¥åŒ–
- **ç¼“å­˜ç­–ç•¥**: é€‚å½“ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“å‹åŠ›
- **è¿æ¥å¤ç”¨**: HTTPå®¢æˆ·ç«¯è¿æ¥æ± 

## ç›‘æ§å’Œè¿ç»´

### 1. å…³é”®æŒ‡æ ‡ç›‘æ§

#### ä¸šåŠ¡æŒ‡æ ‡
- ç”¨æˆ·æ³¨å†ŒæˆåŠŸç‡
- ç”¨æˆ·ç™»å½•æˆåŠŸç‡
- æ¥å£å“åº”æ—¶é—´
- é”™è¯¯ç‡ç»Ÿè®¡

#### ç³»ç»ŸæŒ‡æ ‡
- CPUä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- æ•°æ®åº“è¿æ¥æ•°
- JVM GCé¢‘ç‡

### 2. å‘Šè­¦è®¾ç½®

```yaml
å‘Šè­¦è§„åˆ™:
  - ç”¨æˆ·æ³¨å†Œå¤±è´¥ç‡ > 5%
  - ç”¨æˆ·ç™»å½•å¤±è´¥ç‡ > 10%
  - æ¥å£å“åº”æ—¶é—´ > 2ç§’
  - å†…å­˜ä½¿ç”¨ç‡ > 80%
  - æ•°æ®åº“è¿æ¥æ•° > 15
```

### 3. æ—¥å¿—ç›‘æ§

#### å…³é”®æ—¥å¿—
- ç”¨æˆ·æ³¨å†Œ/ç™»å½•æ—¥å¿—
- æƒé™éªŒè¯å¤±è´¥æ—¥å¿—
- ç³»ç»Ÿå¼‚å¸¸æ—¥å¿—
- æ€§èƒ½æ…¢æŸ¥è¯¢æ—¥å¿—

#### æ—¥å¿—åˆ†æ
- ç”¨æˆ·æ´»è·ƒåº¦åˆ†æ
- å¼‚å¸¸æ“ä½œæ£€æµ‹
- æ€§èƒ½ç“¶é¢ˆè¯†åˆ«
- å®‰å…¨å¨èƒå‘ç°

## æ‰©å±•æ€§è®¾è®¡

### 1. æ°´å¹³æ‰©å±•

- **æ— çŠ¶æ€è®¾è®¡**: æœåŠ¡æ— çŠ¶æ€ï¼Œæ”¯æŒå¤šå®ä¾‹éƒ¨ç½²
- **æ•°æ®åº“åˆ†ç¦»**: è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨æ”¯æŒ
- **ç¼“å­˜é›†ç¾¤**: Redisé›†ç¾¤æ”¯æŒ
- **è´Ÿè½½å‡è¡¡**: Nginx/ALBè´Ÿè½½å‡è¡¡

### 2. åŠŸèƒ½æ‰©å±•

#### è®¤è¯æ–¹å¼æ‰©å±•
- æ‰‹æœºå·éªŒè¯ç ç™»å½•
- é‚®ç®±éªŒè¯ç ç™»å½•
- ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¾®ä¿¡ã€QQã€é’‰é’‰ï¼‰
- ç”Ÿç‰©è¯†åˆ«ç™»å½•

#### å®‰å…¨åŠŸèƒ½æ‰©å±•
- ç™»å½•è¡Œä¸ºåˆ†æ
- å¼‚å¸¸ç™»å½•æ£€æµ‹
- å¯†ç ç­–ç•¥å¼ºåŒ–
- è´¦æˆ·é”å®šæœºåˆ¶

#### ç”¨æˆ·ä¿¡æ¯æ‰©å±•
- ç”¨æˆ·ç”»åƒ
- åå¥½è®¾ç½®
- ç¤¾äº¤å…³ç³»
- æ´»åŠ¨è½¨è¿¹

### 3. é›†æˆæ‰©å±•

#### æ¶ˆæ¯é€šçŸ¥
- çŸ­ä¿¡é€šçŸ¥
- é‚®ä»¶é€šçŸ¥
- ç«™å†…æ¶ˆæ¯
- æ¨é€é€šçŸ¥

#### æ•°æ®åˆ†æ
- ç”¨æˆ·è¡Œä¸ºåˆ†æ
- ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡
- æŠ¥è¡¨ç”Ÿæˆ
- æ•°æ®å¯¼å‡º

## æœ€ä½³å®è·µ

### 1. å¼€å‘è§„èŒƒ

#### ä»£ç è§„èŒƒ
- éµå¾ªé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ
- ä½¿ç”¨ç»Ÿä¸€çš„ä»£ç æ ¼å¼åŒ–é…ç½®
- ä¿æŒè‰¯å¥½çš„ä»£ç æ³¨é‡Š
- ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•

#### æ¥å£è®¾è®¡
- RESTful APIè®¾è®¡åŸåˆ™
- ç»Ÿä¸€çš„å“åº”æ ¼å¼
- åˆç†çš„HTTPçŠ¶æ€ç ä½¿ç”¨
- å®Œæ•´çš„æ¥å£æ–‡æ¡£

### 2. å®‰å…¨å®è·µ

#### æ•°æ®å®‰å…¨
- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- å¯†ç ä¸å¯é€†åŠ å¯†
- æ•°æ®ä¼ è¾“HTTPSåŠ å¯†
- æ¥å£è®¿é—®æƒé™æ§åˆ¶

#### æ“ä½œå®‰å…¨
- é‡è¦æ“ä½œäºŒæ¬¡ç¡®è®¤
- æ“ä½œæ—¥å¿—å®Œæ•´è®°å½•
- å¼‚å¸¸æ“ä½œå‘Šè­¦
- å®šæœŸå®‰å…¨å®¡è®¡

### 3. è¿ç»´å®è·µ

#### éƒ¨ç½²ç­–ç•¥
- è“ç»¿éƒ¨ç½²å‡å°‘æœåŠ¡ä¸­æ–­
- æ»šåŠ¨æ›´æ–°ä¿è¯æœåŠ¡è¿ç»­æ€§
- è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹
- å®Œæ•´çš„å›æ»šæœºåˆ¶

#### ç›‘æ§ç­–ç•¥
- å…¨é“¾è·¯ç›‘æ§
- å®æ—¶å‘Šè­¦
- æ€§èƒ½åŸºçº¿å»ºç«‹
- å®¹é‡è§„åˆ’

## ç‰ˆæœ¬è§„åˆ’

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… åŸºç¡€ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- âœ… JWTè®¤è¯æœºåˆ¶
- âœ… æƒé™é›†æˆ
- âœ… æ“ä½œæ—¥å¿—è®°å½•

### v1.1.0 (è®¡åˆ’ä¸­)
- ğŸ”„ æ‰‹æœºéªŒè¯ç ç™»å½•
- ğŸ”„ ç”¨æˆ·å¤´åƒä¸Šä¼ 
- ğŸ”„ ç™»å½•è®¾å¤‡ç®¡ç†
- ğŸ”„ å¯†ç å¤æ‚åº¦ç­–ç•¥

### v1.2.0 (è§„åˆ’ä¸­)
- ğŸ“‹ ç¬¬ä¸‰æ–¹ç™»å½•é›†æˆ
- ğŸ“‹ ç”¨æˆ·è¡Œä¸ºåˆ†æ
- ğŸ“‹ å¼‚å¸¸ç™»å½•æ£€æµ‹
- ğŸ“‹ è´¦æˆ·å®‰å…¨ä¸­å¿ƒ

### v2.0.0 (è¿œæœŸè§„åˆ’)
- ğŸ“‹ å¾®æœåŠ¡æ‹†åˆ†ä¼˜åŒ–
- ğŸ“‹ äº‹ä»¶é©±åŠ¨æ¶æ„
- ğŸ“‹ å¤šç§Ÿæˆ·æ”¯æŒ
- ğŸ“‹ å…¨çƒåŒ–éƒ¨ç½²

## æ€»ç»“

User Service ä½œä¸ºç”¨æˆ·ç®¡ç†çš„æ ¸å¿ƒæœåŠ¡ï¼Œæä¾›äº†å®Œæ•´çš„ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠŸèƒ½ã€‚é€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡ã€å®Œå–„çš„å®‰å…¨æœºåˆ¶ã€å…¨é¢çš„ç›‘æ§ä½“ç³»ï¼Œç¡®ä¿äº†æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€é«˜æ€§èƒ½å’Œé«˜å®‰å…¨æ€§ã€‚

### æ ¸å¿ƒä¼˜åŠ¿
1. **åŠŸèƒ½å®Œæ•´**: è¦†ç›–ç”¨æˆ·ç®¡ç†çš„å…¨ç”Ÿå‘½å‘¨æœŸ
2. **æ¶æ„åˆç†**: å¾®æœåŠ¡è®¾è®¡ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
3. **å®‰å…¨å¯é **: å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œå®Œæ•´çš„å®¡è®¡æ—¥å¿—
4. **æ€§èƒ½ä¼˜è‰¯**: é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œä¼˜ç§€çš„å“åº”æ—¶é—´
5. **æ˜“äºç»´æŠ¤**: å®Œå–„çš„æ–‡æ¡£ï¼Œæ ‡å‡†çš„å¼€å‘è§„èŒƒ

### åº”ç”¨åœºæ™¯
- ä¼ä¸šå†…éƒ¨ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
- SaaSå¹³å°ç”¨æˆ·è®¤è¯æœåŠ¡
- ç”µå•†å¹³å°ç”¨æˆ·ä¸­å¿ƒ
- ç§»åŠ¨åº”ç”¨åç«¯æœåŠ¡
- å¾®æœåŠ¡æ¶æ„ä¸­çš„ç”¨æˆ·æœåŠ¡

é€šè¿‡ä¸æ–­çš„åŠŸèƒ½è¿­ä»£å’ŒæŠ€æœ¯ä¼˜åŒ–ï¼ŒUser Service å°†ä¸ºå„ç§åº”ç”¨åœºæ™¯æä¾›ç¨³å®šã€é«˜æ•ˆçš„ç”¨æˆ·ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚

---

*æœ€åæ›´æ–°æ—¶é—´: 2024-06-21*
